import{de as t,df as i,dg as e,ej as s,dh as o,Z as n,eR as h,dj as a,eS as r}from"./index-Ojv4YyAF.js";const l={t:"top",m:"marginTop",b:"bottom"},m={l:"left",m:"marginLeft",r:"right"};const d={name:"vue-drag-resize",emits:["clicked","dragging","dragstop","resizing","resizestop","activated","deactivated"],props:{stickSize:{type:Number,default:8},parentScaleX:{type:Number,default:1},parentScaleY:{type:Number,default:1},isActive:{type:Boolean,default:!1},preventActiveBehavior:{type:Boolean,default:!1},isDraggable:{type:Boolean,default:!0},isResizable:{type:Boolean,default:!0},aspectRatio:{type:Boolean,default:!1},parentLimitation:{type:Boolean,default:!1},snapToGrid:{type:Boolean,default:!1},gridX:{type:Number,default:50,validator:t=>t>=0},gridY:{type:Number,default:50,validator:t=>t>=0},parentW:{type:Number,default:0,validator:t=>t>=0},parentH:{type:Number,default:0,validator:t=>t>=0},w:{type:[String,Number],default:200,validator:t=>"string"==typeof t?"auto"===t:t>=0},h:{type:[String,Number],default:200,validator:t=>"string"==typeof t?"auto"===t:t>=0},minw:{type:Number,default:50,validator:t=>t>=0},minh:{type:Number,default:50,validator:t=>t>=0},x:{type:Number,default:0,validator:t=>"number"==typeof t},y:{type:Number,default:0,validator:t=>"number"==typeof t},z:{type:[String,Number],default:"auto",validator:t=>"string"==typeof t?"auto"===t:t>=0},dragHandle:{type:String,default:null},dragCancel:{type:String,default:null},sticks:{type:Array,default:()=>["tl","tm","tr","mr","br","bm","bl","ml"]},axis:{type:String,default:"both",validator:t=>-1!==["x","y","both","none"].indexOf(t)},contentClass:{type:String,required:!1,default:""}},data:()=>({fixAspectRatio:null,active:null,zIndex:null,parentWidth:null,parentHeight:null,left:null,top:null,right:null,bottom:null,minHeight:null}),beforeCreate(){this.stickDrag=!1,this.bodyDrag=!1,this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}},this.currentStick=null},mounted(){this.parentElement=this.$el.parentNode,this.parentWidth=this.parentW?this.parentW:this.parentElement.clientWidth,this.parentHeight=this.parentH?this.parentH:this.parentElement.clientHeight,this.left=this.x,this.top=this.y,this.right=this.parentWidth-("auto"===this.w?this.$refs.container.scrollWidth:this.w)-this.left,this.bottom=this.parentHeight-("auto"===this.h?this.$refs.container.scrollHeight:this.h)-this.top,this.domEvents=new Map([["mousemove",this.move],["mouseup",this.up],["mouseleave",this.up],["mousedown",this.deselect],["touchmove",this.move],["touchend",this.up],["touchcancel",this.up],["touchstart",this.up]]),this.domEvents.forEach(((t,i)=>{document.documentElement.addEventListener(i,t)})),this.dragHandle&&[...this.$el.querySelectorAll(this.dragHandle)].forEach((t=>{t.setAttribute("data-drag-handle",this._uid)})),this.dragCancel&&[...this.$el.querySelectorAll(this.dragCancel)].forEach((t=>{t.setAttribute("data-drag-cancel",this._uid)}))},beforeUnmount(){this.domEvents.forEach(((t,i)=>{document.documentElement.removeEventListener(i,t)}))},methods:{deselect(){this.preventActiveBehavior||(this.active=!1)},move(t){if(!this.stickDrag&&!this.bodyDrag)return;t.stopPropagation();const i=void 0!==t.pageX?t.pageX:t.touches[0].pageX,e=void 0!==t.pageY?t.pageY:t.touches[0].pageY,{dimensionsBeforeMove:s}=this,o={x:(s.pointerX-i)/this.parentScaleX,y:(s.pointerY-e)/this.parentScaleY};if(this.stickDrag&&this.stickMove(o),this.bodyDrag){if("x"===this.axis)o.y=0;else if("y"===this.axis)o.x=0;else if("none"===this.axis)return;this.bodyMove(o)}},up(t){this.stickDrag?this.stickUp(t):this.bodyDrag&&this.bodyUp(t)},bodyDown(t){const{target:i,button:e}=t;if(this.preventActiveBehavior||(this.active=!0),e&&0!==e)return;if(this.$emit("clicked",t),!this.active)return;if(this.dragHandle&&i.getAttribute("data-drag-handle")!==this._uid.toString())return;if(this.dragCancel&&i.getAttribute("data-drag-cancel")===this._uid.toString())return;void 0!==t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.preventDefault(),this.isDraggable&&(this.bodyDrag=!0);const s=void 0!==t.pageX?t.pageX:t.touches[0].pageX,o=void 0!==t.pageY?t.pageY:t.touches[0].pageY;this.saveDimensionsBeforeMove({pointerX:s,pointerY:o}),this.parentLimitation&&(this.limits=this.calcDragLimitation())},bodyMove(t){const{dimensionsBeforeMove:i,parentWidth:e,parentHeight:s,gridX:o,gridY:n,width:h,height:a}=this;let r=i.top-t.y,l=i.bottom+t.y,m=i.left-t.x,d=i.right+t.x;if(this.snapToGrid){let t=!0,i=!0,p=r-Math.floor(r/n)*n,c=s-l-Math.floor((s-l)/n)*n,u=m-Math.floor(m/o)*o,g=e-d-Math.floor((e-d)/o)*o;p>n/2&&(p-=n),c>n/2&&(c-=n),u>o/2&&(u-=o),g>o/2&&(g-=o),Math.abs(c)<Math.abs(p)&&(t=!1),Math.abs(g)<Math.abs(u)&&(i=!1),r-=t?p:c,l=s-a-r,m-=i?u:g,d=e-h-m}({newLeft:this.left,newRight:this.right,newTop:this.top,newBottom:this.bottom}=this.rectCorrectionByLimit({newLeft:m,newRight:d,newTop:r,newBottom:l})),this.$emit("dragging",this.rect)},bodyUp(){this.bodyDrag=!1,this.$emit("dragging",this.rect),this.$emit("dragstop",this.rect),this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}}},stickDown(t,i,e=!1){if(!(this.isResizable&&this.active||e))return;this.stickDrag=!0;const s=void 0!==i.pageX?i.pageX:i.touches[0].pageX,o=void 0!==i.pageY?i.pageY:i.touches[0].pageY;this.saveDimensionsBeforeMove({pointerX:s,pointerY:o}),this.currentStick=t,this.limits=this.calcResizeLimits()},saveDimensionsBeforeMove({pointerX:t,pointerY:i}){this.dimensionsBeforeMove.pointerX=t,this.dimensionsBeforeMove.pointerY=i,this.dimensionsBeforeMove.left=this.left,this.dimensionsBeforeMove.right=this.right,this.dimensionsBeforeMove.top=this.top,this.dimensionsBeforeMove.bottom=this.bottom,this.dimensionsBeforeMove.width=this.width,this.dimensionsBeforeMove.height=this.height,this.aspectFactor=this.width/this.height},stickMove(t){const{currentStick:i,dimensionsBeforeMove:e,gridY:s,gridX:o,snapToGrid:n,parentHeight:h,parentWidth:a}=this;let r=e.top,l=e.bottom,m=e.left,d=e.right;switch(i[0]){case"b":l=e.bottom+t.y,n&&(l=h-Math.round((h-l)/s)*s);break;case"t":r=e.top-t.y,n&&(r=Math.round(r/s)*s)}switch(i[1]){case"r":d=e.right+t.x,n&&(d=a-Math.round((a-d)/o)*o);break;case"l":m=e.left-t.x,n&&(m=Math.round(m/o)*o)}({newLeft:m,newRight:d,newTop:r,newBottom:l}=this.rectCorrectionByLimit({newLeft:m,newRight:d,newTop:r,newBottom:l})),this.aspectRatio&&({newLeft:m,newRight:d,newTop:r,newBottom:l}=this.rectCorrectionByAspectRatio({newLeft:m,newRight:d,newTop:r,newBottom:l})),this.left=m,this.right=d,this.top=r,this.bottom=l,this.$emit("resizing",this.rect)},stickUp(){this.stickDrag=!1,this.dimensionsBeforeMove={pointerX:0,pointerY:0,x:0,y:0,w:0,h:0},this.limits={left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}},this.$emit("resizing",this.rect),this.$emit("resizestop",this.rect)},calcDragLimitation(){const{parentWidth:t,parentHeight:i}=this;return{left:{min:0,max:t-this.width},right:{min:0,max:t-this.width},top:{min:0,max:i-this.height},bottom:{min:0,max:i-this.height}}},calcResizeLimits(){const{aspectFactor:t,width:i,height:e,bottom:s,top:o,left:n,right:h}=this;let{minh:a,minw:r}=this;const l=this.parentLimitation?0:null;this.aspectRatio&&(r/a>t?a=r/t:r=t*a);const m={left:{min:l,max:n+(i-r)},right:{min:l,max:h+(i-r)},top:{min:l,max:o+(e-a)},bottom:{min:l,max:s+(e-a)}};if(this.aspectRatio){const l={left:{min:n-Math.min(o,s)*t*2,max:n+(e-a)/2*t*2},right:{min:h-Math.min(o,s)*t*2,max:h+(e-a)/2*t*2},top:{min:o-Math.min(n,h)/t*2,max:o+(i-r)/2/t*2},bottom:{min:s-Math.min(n,h)/t*2,max:s+(i-r)/2/t*2}};"m"===this.currentStick[0]?(m.left={min:Math.max(m.left.min,l.left.min),max:Math.min(m.left.max,l.left.max)},m.right={min:Math.max(m.right.min,l.right.min),max:Math.min(m.right.max,l.right.max)}):"m"===this.currentStick[1]&&(m.top={min:Math.max(m.top.min,l.top.min),max:Math.min(m.top.max,l.top.max)},m.bottom={min:Math.max(m.bottom.min,l.bottom.min),max:Math.min(m.bottom.max,l.bottom.max)})}return m},sideCorrectionByLimit(t,i){let e=i;return null!==t.min&&i<t.min?e=t.min:null!==t.max&&t.max<i&&(e=t.max),e},rectCorrectionByLimit(t){const{limits:i}=this;let{newRight:e,newLeft:s,newBottom:o,newTop:n}=t;return s=this.sideCorrectionByLimit(i.left,s),e=this.sideCorrectionByLimit(i.right,e),n=this.sideCorrectionByLimit(i.top,n),o=this.sideCorrectionByLimit(i.bottom,o),{newLeft:s,newRight:e,newTop:n,newBottom:o}},rectCorrectionByAspectRatio(t){let{newLeft:i,newRight:e,newTop:s,newBottom:o}=t;const{parentWidth:n,parentHeight:h,currentStick:a,aspectFactor:r,dimensionsBeforeMove:l}=this;let m=n-i-e,d=h-s-o;if("m"===a[1]){const t=d-l.height;i-=t*r/2,e-=t*r/2}else if("m"===a[0]){const t=m-l.width;s-=t/r/2,o-=t/r/2}else m/d>r?(m=r*d,"l"===a[1]?i=n-e-m:e=n-i-m):(d=m/r,"t"===a[0]?s=h-o-d:o=h-s-d);return{newLeft:i,newRight:e,newTop:s,newBottom:o}}},computed:{positionStyle(){return{top:this.top+"px",left:this.left+"px",zIndex:this.zIndex}},sizeStyle(){return{width:this.width+"px",height:this.height+"px"}},vdrStick(){return t=>{const i={width:this.stickSize/this.parentScaleX+"px",height:this.stickSize/this.parentScaleY+"px"};return i[l[t[0]]]=this.stickSize/this.parentScaleX/-2+"px",i[m[t[1]]]=this.stickSize/this.parentScaleX/-2+"px",i}},width(){return this.parentWidth-this.left-this.right},height(){return this.parentHeight-this.top-this.bottom},rect(){return{left:Math.round(this.left),top:Math.round(this.top),width:Math.round(this.width),height:Math.round(this.height)}}},watch:{active(t){t?this.$emit("activated"):this.$emit("deactivated")},isActive:{immediate:!0,handler(t){this.active=t}},z:{immediate:!0,handler(t){(t>=0||"auto"===t)&&(this.zIndex=t)}},x:{handler(t,i){if(this.stickDrag||this.bodyDrag||t===this.left)return;const e=i-t;this.bodyDown({pageX:this.left,pageY:this.top}),this.bodyMove({x:e,y:0}),this.$nextTick((()=>{this.bodyUp()}))}},y:{handler(t,i){if(this.stickDrag||this.bodyDrag||t===this.top)return;const e=i-t;this.bodyDown({pageX:this.left,pageY:this.top}),this.bodyMove({x:0,y:e}),this.$nextTick((()=>{this.bodyUp()}))}},w:{handler(t,i){if(this.stickDrag||this.bodyDrag||t===this.width)return;const e=i-t;this.stickDown("mr",{pageX:this.right,pageY:this.top+this.height/2},!0),this.stickMove({x:e,y:0}),this.$nextTick((()=>{this.stickUp()}))}},h:{handler(t,i){if(this.stickDrag||this.bodyDrag||t===this.height)return;const e=i-t;this.stickDown("bm",{pageX:this.left+this.width/2,pageY:this.bottom},!0),this.stickMove({x:0,y:e}),this.$nextTick((()=>{this.stickUp()}))}},parentW(t){this.right=t-this.width-this.left,this.parentWidth=t},parentH(t){this.bottom=t-this.height-this.top,this.parentHeight=t}}},p=["onMousedown","onTouchstart"];const c=((t,i)=>{const e=t.__vccOpts||t;for(const[s,o]of i)e[s]=o;return e})(d,[["render",function(l,m,d,c,u,g){return t(),i("div",{class:a(["vdr",`${l.active||l.isActive?"active":"inactive"} ${l.contentClass?l.contentClass:""}`]),style:o(l.positionStyle),onMousedown:m[0]||(m[0]=t=>l.bodyDown(t)),onTouchstart:m[1]||(m[1]=t=>l.bodyDown(t)),onTouchend:m[2]||(m[2]=t=>l.up(t)),ref:"container",tabindex:"0"},[e("div",{style:o(l.sizeStyle),class:"content-container",ref:"container2"},[s(l.$slots,"default")],4),(t(!0),i(n,null,h(l.sticks,(e=>(t(),i("div",{class:a(["vdr-stick",["vdr-stick-"+e,l.isResizable?"":"not-resizable"]]),onMousedown:r((t=>l.stickDown(e,t)),["stop","prevent"]),onTouchstart:r((t=>l.stickDown(e,t)),["stop","prevent"]),style:o(l.vdrStick(e))},null,46,p)))),256))],38)}]]);export{c as V};
